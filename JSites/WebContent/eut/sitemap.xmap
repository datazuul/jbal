<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE map:sitemap [
<!ENTITY generalpipeline SYSTEM "../sitemap/generalpipeline.dat">
<!ENTITY auth-manager SYSTEM "../sitemap/auth-manager.dat">
<!ENTITY auth-pipeline SYSTEM "../sitemap/auth-pipeline.dat">
<!ENTITY main-pipeline SYSTEM "../sitemap/main-pipeline.dat">
<!ENTITY auth-method SYSTEM "../sitemap/auth-method.dat">
<!ENTITY ordering-pipeline SYSTEM "ordering/ordering-pipeline.dat">
]>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

	<!-- PLEASE DO MODIFY ONLY THE PART BELOW -->
	
	<map:components>
		<map:serializers>
			<map:serializer name="fo2pdf" src="org.apache.cocoon.serialization.FOPSerializer" mime-type="application/pdf"/>
		</map:serializers>
	</map:components>
	

	<map:pipelines>

		<map:component-configurations>
			
			&auth-manager;
			
			<global-variables>
				<db>dbeut</db>
				<sitename>eut</sitename>
				<data-directory>/siti/eut_components</data-directory>
				<showAreasInFirstLevelPages>true</showAreasInFirstLevelPages>
				<template>unitsnew</template>
				<ad_connect_string>ldap://dc1ts.ds.units.it:389/dc=ds,dc=units,dc=it</ad_connect_string>
                                <ad_realm>DS</ad_realm>
				<serializer>xhtml10transitional</serializer>
			</global-variables>
			
		</map:component-configurations>

		
		<map:pipeline>
			<map:match pattern="iztok.pdf">
				<map:generate src="http://flip.units.it/JOpac2/eut/paramSearch(1)?cocoon-view=xml&amp;C7=ANY&amp;R7="/>
				<map:transform src="xslt/fo/xml2fo.xslt"/>
		        <!--map:serialize type="xml"/-->
   		        <map:serialize type="fo2pdf"/>
	    	</map:match>
	    </map:pipeline>
		
		<map:pipeline>
			<map:match pattern="pagesearch(*)">
		        <map:aggregate element="page">
					<map:part src="cocoon://csscontent?db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}"/>
					<map:part src="cocoon://viewheader?pid=7&amp;db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}">
						<map:parameter name="use-request-parameters" value="true"/>
		            </map:part>
					<map:part src="cocoon://viewnavbar?pid=7&amp;db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}">
						<map:parameter name="use-request-parameters" value="true"/>
		            </map:part>
		            <map:part src="{context}/components/catalogSearch/viewxml?query={url-encode:{request-param:key}}&amp;catalog=eutmarc"/>
					<map:part src="cocoon://viewfooter?db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}">
						<map:parameter name="use-request-parameters" value="true"/>
		            </map:part>
		        </map:aggregate>
		        <map:act type="request">
					<map:transform type="xslt" src="xslt/search2xhtml.xslt">
		                <map:parameter name="use-request-parameters" value="true"/>
		                <map:parameter name="query" value="{requestURI}{requestQuery}" />
		            </map:transform>
	            </map:act>
	            <map:transform type="session" />
		        <map:transform type="xslt" src="xslt/xml2xhtml.xslt"/>
		        <map:transform type="encodeURL"/>
		        <map:serialize type="xml"/> <!-- xhtml10transitional -->
	    	</map:match>
	    	
		<map:match pattern="order*">
		        <map:aggregate element="page">
					<map:part src="cocoon://csscontent?db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}"/> 
					<map:part src="cocoon://viewheader?pid=2&amp;db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}">
						<map:parameter name="use-request-parameters" value="true"/>
		            </map:part> 
					<map:part src="cocoon://viewnavbar?pid=2&amp;db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}">
						<map:parameter name="use-request-parameters" value="true"/>
		            </map:part>
		            <map:part src="cocoon://Order{1}">
			            <map:parameter name="use-request-parameters" value="true"/>
			        </map:part> 
					<map:part src="cocoon://viewfooter?pid=2&amp;db={global:db}&amp;site={global:sitename}&amp;datadir={global:data-directory}&amp;showAreasInFirstLevelPages={global:showAreasInFirstLevelPages}">
						<map:parameter name="use-request-parameters" value="true"/>
		            </map:part>
		        </map:aggregate>
				<!--map:transform type="xslt" src="xslt/search2xhtml.xslt">
	                <map:parameter name="use-request-parameters" value="true"/>
	            </map:transform-->
		       <map:transform type="xslt" src="context://templates/{global:template}/xslt/xml2xhtml.xslt"> 
				<map:parameter name="context" value="{context}"/>
	        		<map:parameter name="pid" value="{request-param:pid}"/>
	        		<map:parameter name="template" value="{global:template}"/>
	        		<map:parameter name="sitename" value="{global:sitename}"/>
	        		<map:parameter name="pageid" value="{request-attr:pid}"/>
	        		<map:parameter name="pagecode" value="{request-attr:pcode}"/>
	        		<map:parameter name="pagename" value="{request-attr:name}"/>
	        		<map:parameter name="pageusername" value="{request-attr:username}"/>
	        		<map:parameter name="pagechangeip" value="{request-attr:remoteip}"/>
	        		<map:parameter name="pagedate" value="{request-attr:insertdate}"/>
	        		<map:parameter name="pageresp" value="{request-attr:resp}"/>
			</map:transform>
		        <map:transform type="encodeURL"/>
		        <map:serialize type="xml"/> <!-- xhtml10transitional -->
	    	</map:match>
	    	
	    	<map:match pattern="WhatSession">
	    		<map:generate type="request"/>
	    		<map:transform src="xslt/viewSession.xslt"/>
	    		<map:transform type="session" />
	    		<map:serialize type="xml"/>
	    	</map:match>
	    </map:pipeline>
	    
	    &ordering-pipeline;

	<!-- PLEASE DO MODIFY ONLY THE PART ABOVE -->
		&auth-pipeline;
		&auth-method;
		&main-pipeline;
		&generalpipeline;
	</map:pipelines>					
</map:sitemap>
