<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE map:sitemap [
<!ENTITY generalComponentPipeline SYSTEM "../generalComponentPipeline.dat">
]>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	
	<map:components>
        <map:transformers>
            <map:transformer name="catalogSearch" label="content" pool-max="16" src="JSites.transformation.catalogSearch.CatalogSearchTransformer"/>
            <map:transformer name="catalogSearchSave" label="content" pool-max="16" src="JSites.transformation.catalogSearch.CatalogSearchSaveTransformer"/>
            <map:transformer name="record2display" label="content" pool-max="16" src="JSites.transformation.catalogSearch.Record2display"/>
            <map:transformer name="catalogTemplator" label="content" pool-max="16" src="JSites.transformation.catalogSearch.Templator"/>
        </map:transformers>
	</map:components>
	
	<map:pipelines>
			<map:component-configurations>
				<global-variables>
					<component-name>catalogSearch</component-name>
				</global-variables>
			</map:component-configurations>
			
			<map:pipeline internal-only="false">

				<map:match pattern="view">
					<map:act type="request">
					 	<map:parameter name="parameters" value="true" />
					 	
	                    	<map:generate type="componentGenerator" src="{global:data-directory}/data/catalogSearch{request-param:cid}.xml"/>
	                    
	                    <!-- map:transform type="tutil" src="/t/template" / -->
	                    
	                    <map:transform type="catalogSearch">
	                    	<map:parameter name="db" value="{global:db}" />
	                    </map:transform>
	                    
	                    
	                    <map:transform type="record2display">
	                    	<map:parameter name="db" value="{global:db}" />
	                    </map:transform>
	
	                    <map:transform type="catalogTemplator">
	                    	<map:parameter name="db" value="{global:db}" />
	                    </map:transform>
	                    
					 	<!-- map:transform type="tutil" src="/t/template" / -->
					
	                    <map:transform src="catalogSearch.xslt">	                    	
	                    	<map:parameter name="cid" value="{request-param:cid}"/>
							<map:parameter name="pid" value="{request-param:pid}"/>
							<map:parameter name="pacid" value="{request-param:pacid}"/>
							<map:parameter name="editing" value="{request-param:editing}"/>
							<map:parameter name="lang" value="{request-param:lang}"/>
						    <map:parameter name="validating" value="{request-param:validating}"/>
						    <map:parameter name="disabling" value="{request-param:disabling}"/>
						    <map:parameter name="time" value="{request-param:time}"/>
						    <map:parameter name="extra" value="{request-param:extra}"/>
						    <map:parameter name="type" value="{request-param:type}" />
						    <map:parameter name="container" value="{request-param:container}" />	                    	
	                    	
	                    	<map:parameter name="page" value="{request-attr:page}"/>
	                    	<!-- map:parameter name="query" value="{request-attr:query}"/ -->
	                    	<map:parameter name="orderby" value="{request-attr:orderby}"/>
	                    	<map:parameter name="rxp" value="{request-attr:rxp}"/>
	                    </map:transform>
	                </map:act> 	
                    <map:transform type="wikitrans"/>
                    <map:serialize type="xml"/>
	                
	            </map:match>
	            
	            <map:match pattern="viewxml">
					<map:act type="request">
					 	<map:parameter name="parameters" value="true" />
					 
	                    <map:generate type="componentGenerator" src="{global:data-directory}/data/catalogSearch{request-param:cid}.xml"/>
	                    <!-- map:transform type="tutil" src="/t/template" / -->
	                    <map:transform type="catalogSearch">
	                    	<map:parameter name="db" value="{global:db}" />
	                    </map:transform>
	                    
	                    
	                    <map:transform type="record2display">
	                    	<map:parameter name="db" value="{global:db}" />
	                    </map:transform>
	
	                    <!-- map:transform type="catalogTemplator">
	                    	<map:parameter name="db" value="{global:db}" />
	                    </map:transform>
					
	                    <map:transform src="catalogSearch.xslt">
							<map:parameter name="cid" value="{request-param:cid}"/>
							<map:parameter name="pid" value="{request-param:pid}"/>
							<map:parameter name="pacid" value="{request-param:pacid}"/>
							<map:parameter name="editing" value="{request-param:editing}"/>
							<map:parameter name="lang" value="{request-param:lang}"/>
						    <map:parameter name="validating" value="{request-param:validating}"/>
						    <map:parameter name="disabling" value="{request-param:disabling}"/>
						    <map:parameter name="time" value="{request-param:time}"/>
						    <map:parameter name="extra" value="{request-param:extra}"/>
						    <map:parameter name="type" value="{request-param:type}" />	                    	
						    <map:parameter name="page" value="{request-attr:page}"/>
	                    	<map:parameter name="query" value="{request-attr:query}"/>
	                    	<map:parameter name="orderby" value="{request-attr:orderby}"/>
	                    </map:transform -->
	                </map:act> 	
                    <!-- map:transform type="wikitrans"/ -->
                    <map:serialize type="xml"/>
	                
	            </map:match>
	            
	            <map:match pattern="save">
	            	<map:generate type="componentGenerator" src="{request-param:datadir}/data/catalogSearch0.xml"/>
					<map:transform type="catalogSearchSave"/>
					
					<map:act type="request">
						<map:transform src="catalogSearchsave.xslt">
							<map:parameter name="datadir" value="{request-param:datadir}/data/catalogSearch{request-param:cid}.xml"/>
						</map:transform>
					</map:act>
					
					<!-- map:transform type="tutil" src="/t/catalogSaved" / -->
					
								
					<map:transform type="write-source"/>
					<map:transform src="../section/saving.xslt" />
	                <map:serialize type="xml"/>
				</map:match>

		</map:pipeline>
		
		&generalComponentPipeline;
		
	</map:pipelines>
	
</map:sitemap>