<?xml version="1.0" encoding="UTF-8"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	
	<map:components>
        <map:generators default="file">

            <map:generator name="file" label="content" pool-max="32" src="org.apache.cocoon.generation.FileGenerator"/>
            <map:generator name="request" label="content" pool-max="16" src="org.apache.cocoon.generation.RequestGenerator"/>
            <map:generator name="redirSection" label="content" pool-max="16" src="JSites.generation.RedirSectionGenerator"/>
        </map:generators>
        
        
        <map:transformers default="xslt">
            <map:transformer name="xslt" pool-max="32" src="org.apache.cocoon.transformation.TraxTransformer">
                <use-request-parameters>false</use-request-parameters>
                <use-session-parameters>false</use-session-parameters>
                <use-cookie-parameters>false</use-cookie-parameters>
                <xslt-processor-role>xalan</xslt-processor-role>
                <check-includes>true</check-includes>
            </map:transformer>
        	<map:transformer name="write-source" src="org.apache.cocoon.transformation.SourceWritingTransformer">
        		<map:parameter name="serializer" value="xml"/>
        	</map:transformer>
        	<map:transformer name="emptySession" src="JSites.transformation.EmptySession"/>
        	
        	
        	
        	<!--map:transformer name="selectParts" src="JSites.transformation.PartSelector">
        		<map:parameter name="serializer" value="xml"/>
        	</map:transformer-->
        </map:transformers>
        
        <map:serializers default="html">
        
            <map:serializer mime-type="text/xml" name="xml" src="org.apache.cocoon.serialization.XMLSerializer"/>
            <map:serializer mime-type="text/html" name="xhtml" ppool-max="64" src="org.apache.cocoon.serialization.XMLSerializer">
				<doctype-public>-//W3C//DTD XHTML 1.0 Strict//EN</doctype-public>
      			<doctype-system>http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</doctype-system>
      			<encoding>UTF-8</encoding>
    		</map:serializer>
            
        </map:serializers>
        
	</map:components>
	
	<map:pipelines>
		
		<map:pipeline internal-only="false"> 
		
				<map:match pattern="view">
	                <map:act type="request">
	                    <map:parameter name="parameters" value="true" />
	                    <map:generate type="redirSection" />
	                    <map:transform src="doMsg.xslt"/>
	                    <map:transform src="context://components/section/section.xslt">
							<map:parameter name="lang" value="{request-param:lang}"/>
						    <map:parameter name="validating"  value="{request-param:validating}"/>
						    <map:parameter name="disabling" value="{request-param:disabling}"/>
						    <map:parameter name="time" value="{request-param:time}"/>
						    <map:parameter name="extra"  value="{request-param:extra}"/>
						    <map:parameter name="type"  value="{request-param:type}"/>
	                    	<map:parameter name="cid"  value="{request-param:cid}"/>
							<map:parameter name="pid"  value="{request-param:pid}"/>
							<map:parameter name="pacid"  value="{request-param:pacid}"/>
							<map:parameter name="editing"  value="{request-param:editing}"/>
	                    </map:transform>
	                    
	                    <map:transform type="wikitrans"/>
	                    <map:serialize type="xml"/>
	                </map:act>
	            </map:match>
	            
	            <map:match pattern="edit">
	                <map:act type="request">
	             		<map:generate src="query.xml"/>
	                    <map:transform src="addPid.xslt">
	                    	<map:parameter name="pid" value="{request-param:pid}"/>
	                    </map:transform>
	                    

	                    <map:transform type="sql">
							<map:parameter name="use-connection" value="{request-param:db}"/>
						</map:transform>

	                    <map:transform src="doExternalLink.xslt"/>
	                 	<map:transform src="externalLinkedit.xslt">
							<map:parameter name="cid"  value="{request-param:cid}"/>
							<map:parameter name="pid"  value="{request-param:pid}"/>
							<map:parameter name="time"  value="{request-param:time}"/>
	                    </map:transform>

	                    <map:serialize type="xml"/>
	                </map:act>
	            </map:match>
	            
	            
	            <map:match pattern="save">
	            	<map:act type="request">
	             		<map:generate src="querySave.xml"/>
	                    <map:transform src="addPid.xslt">
	                    	<map:parameter name="pid" value="{request-param:pid}"/>
	                    	<map:parameter name="url" value="{request-param:url}"/>
	                    </map:transform>
	                    
	                    <map:transform type="sql">
							<map:parameter name="use-connection" value="{request-param:db}"/>
						</map:transform>
						
	                    <map:transform src="doExternalLink.xslt"/>
							                    
	                 	<map:transform src="externalLinksave.xslt">
	                    	<map:parameter name="cid"  value="{request-param:cid}"/>
							<map:parameter name="pid"  value="{request-param:pid}"/>
							<map:parameter name="time"  value="{request-param:time}"/>
	                    </map:transform>

	                    <map:transform type="emptySession" />
	                    <map:serialize type="xml"/>
	                </map:act>

				</map:match>
<!--
				<map:match pattern="order">
				 	<map:act type="request">
	                    <map:parameter name="parameters" value="true"/>
	                    <map:generate src="/sito_components/data/externalLink.xml" label="edit"/>
	                    
	                    <map:transform src="../section/sectionorder.xslt">
	                    	<map:parameter name="use-request-parameters" value="true"/>
	                    </map:transform>
	                    
	                    <map:transform src="../section/section.xslt">
	                        <map:parameter name="use-request-parameters" value="true"/>
	                    </map:transform>
	                    
	                    <map:transform type="wikitrans"/>
	                    <map:serialize type="xhtml" />
	                </map:act>
				</map:match>
-->
						
		</map:pipeline>
		
	</map:pipelines>
	
</map:sitemap>