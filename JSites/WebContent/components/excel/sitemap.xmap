<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE map:sitemap [
<!ENTITY generalComponentPipeline SYSTEM "../generalComponentPipeline.dat">
]>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

	

	<map:components>
		
        <map:transformers default="xslt">	
       		<map:transformer name="upload-parser" src="JSites.transformation.uploadparsing.ExcelUploadParser"/>
        </map:transformers>
        
	</map:components>
	
	<map:pipelines>
	
		<map:pipeline internal-only="true"> 
	            
	            <map:match pattern="view">
	                <map:act type="request">
	                    <map:parameter name="parameters" value="true"/>
	                    <map:generate type="componentGenerator" src="{request-param:datadir}/data/excel{cid}.xml"/>
	                    <map:transform src="excel.xslt">
	                    	<map:parameter name="cid"  value="{request-param:cid}"/>
							<map:parameter name="pid"  value="{request-param:pid}"/>
							<map:parameter name="editing"  value="{request-param:editing}"/>
							<map:parameter name="validating"  value="{request-param:validating}"/>
							<map:parameter name="disabling"  value="{request-param:disabling}"/>
	                    	<map:parameter name="time" value="{request-param:time}"/>
	                    </map:transform>
	                    <map:transform type="wikitrans" />
	                    <map:serialize type="xml"/>
	                </map:act>
	            </map:match>
	            
	            <map:match pattern="edit">
	                <map:act type="request">
	                	<map:parameter name="parameters" value="true"/>
	                    <map:generate type="componentGenerator" src="{request-param:datadir}/data/excel{cid}.xml"/>
	                    <map:transform src="exceledit.xslt">
							<map:parameter name="cid"  value="{request-param:cid}"/>
							<map:parameter name="pid"  value="{request-param:pid}"/>
							<map:parameter name="rows"  value="{request-param:rows}"/>
							<map:parameter name="cols"  value="{request-param:cols}"/>
							<map:parameter name="redim"  value="{request-param:redim}"/>
							<map:parameter name="pacid"  value="{request-param:pacid}"/>
							<map:parameter name="time" value="{request-param:time}"/>
	                    </map:transform>
	                    <map:serialize type="xml"/>
	                </map:act>
	            </map:match>
	            
	            <map:match pattern="save">
	            	<map:act type="request">
						<map:generate type="internalSave"/>
						<map:transform type="upload-parser"/>
						
						<map:transform src="excelsave.xslt" type="xsltc" />
						<map:transform type="write-source"/>
						<map:transform type="xslt" src="result.xslt">
							<map:parameter name="cid"  value="{request-param:cid}"/>
							<map:parameter name="pid"  value="{request-param:pid}"/>
							<map:parameter name="pacid"  value="{request-param:pacid}"/>
							<map:parameter name="state"  value="{request-param:state}"/>						
						</map:transform>
						<map:transform type="wikitrans"/>
						<map:transform type="cinclude"/>
						<map:serialize type="xml"/>
					</map:act>
				</map:match>

				
				<map:handle-errors>
					<map:select type="exception">
                        <map:when test="file-not-found">
							<map:generate type="timeGenerator"/>
                            <map:serialize type="xml"/>
                        </map:when>
					</map:select>
				</map:handle-errors>

		</map:pipeline>
		
		&generalComponentPipeline;
		
	</map:pipelines>
	
</map:sitemap>